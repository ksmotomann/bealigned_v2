<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BeAligned - Transform Conflict into Connection</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body, html {
      height: 100%;
      overflow: hidden;
    }
    #figma-frame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #4A90E2;
      font-size: 18px;
    }
  </style>
  <script>
    // Detect mobile devices and redirect to Figma site directly
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Get the current path to preserve it in redirect
    const currentPath = window.location.pathname;

    // If mobile, redirect to Figma site directly (no iframe)
    if (isMobileDevice()) {
      let figmaUrl = 'https://bealigned.figma.site';

      // Preserve the path if it's a marketing page
      if (currentPath !== '/') {
        figmaUrl += currentPath;
      }

      window.location.href = figmaUrl;
    }

    // Desktop: Continue with iframe approach
    // Listen for messages from the iframe (if Figma allows postMessage)
    window.addEventListener('message', function(event) {
      // Check if message is from Figma site
      if (event.origin === 'https://bealigned.figma.site') {
        // Handle navigation requests
        if (event.data && event.data.type === 'navigation') {
          window.location.href = event.data.url;
        }
      }
    });

    // Detect iframe errors and redirect to app routes
    window.addEventListener('load', function() {
      const iframe = document.getElementById('figma-frame');

      // Monitor iframe for 404 errors (limited capability due to cross-origin)
      iframe.addEventListener('error', function() {
        console.log('Iframe error detected');
      });
    });

    // Check if user is trying to access app routes directly
    const path = window.location.pathname;
    const appRoutes = ['/login', '/signup', '/dashboard', '/chat', '/profile', '/settings', '/admin', '/history', '/subscription', '/welcome', '/session'];

    if (appRoutes.some(route => path.startsWith(route))) {
      // Don't load iframe for app routes - let the app handle it
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('figma-frame').style.display = 'none';
      });
    }
  </script>
</head>
<body>
  <div class="loading" id="loading">Loading BeAligned...</div>
  <iframe
    id="figma-frame"
    src="https://bealigned.figma.site/"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation"
    onload="document.getElementById('loading').style.display='none'"
  ></iframe>
</body>
</html>